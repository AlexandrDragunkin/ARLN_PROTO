////////////////////////////////////////////////////////////////////////////////
//		К3
//		ПРОФИЛЬНЫЕ СИСТЕМЫ
//		EndCutPP
//		определение параметров подрезки объекта профильной системы
//
////////////////////////////////////////////////////////////////////////////////
//	определение констант
//DefName="обв.внутр.80"
//DefStojka=1
//////////////////////////////////////////////////////////////////////////
//		глобальные переменные
global ProtoPath ;
global PrStBuf;
Defarr PrStBuf[200,16];		//	кэш для парметров стыковки профилей
////////////////////////////////////////////////////////////////////////////////
// получим параметры
//
getpar
	Pro					//	описание профильной системы
	Obj					//	объект для которого выполняется подрезка
	Beg					//	второй объект
	Typ		      //	тип соединения
	Cut   			//	параметры соединения
	;
////////////////////////////////////////////////////////////////////////////////
i=0
CashFind:i=i+1
if (PrStBuf[i,1]!=0)	{
	////////////////////////////////////
	if ((PrStBuf[i,1]==Typ)&&(PrStBuf[i,2]==Obj[4])&&(PrStBuf[i,3]==Beg[4]))	{
		//////////////////////////////////
		//	запись найдена в кэше
		Cut[1]=PrStBuf[i,8+1];
		Cut[2]=PrStBuf[i,8+2];
		Cut[3]=PrStBuf[i,8+3];
		Cut[4]=PrStBuf[i,8+4];
		Cut[5]=PrStBuf[i,8+5];
		Cut[6]=PrStBuf[i,8+6];
		exit;
		}
	////////////////////////////////////
	if (i<200)	{
		goto CashFind;
		}
	}
////////////////////////////////////////////////////////////////////////////////
//	база с составом
id=0
filter="";
Cut[1]=0; Cut[2]=0; Cut[3]=0; Cut[4]=0; Cut[5]=0; Cut[6]=0;

filter=filter+"(id1=="+str(Obj[4])+")";
filter=filter+"&&(id2=="+str(Beg[4])+")";
filter=filter+"&&(sltype=="+str(Typ)+")";
DbOpen id,ProtoPath+Pro[4],filter;

if (DbRecCount(id)<1)	{
	DbClose id;
	exit;
	}

ids=0;
sec1=0;
sec2=0;

DbRead:

ids=DbGetValue(id,"ids",0);
sec1=DbGetValue(id,"sec1",0);
sec2=DbGetValue(id,"sec2",0);

Cut[1]=ids;			//	тип соединения
Cut[2]=sec1;    //	подрез профиля
Cut[3]=sec2;    //	подрез профиля

DbClose id
////////////////////////////////////////////////////////////////////////////////
//	здесь запишем в кэш найденное
i=0
Cashsave:i=i+1
if (PrStBuf[i,1]==0)	{
	////////////////////////////////////
	//	запись в кэш
	//
	PrStBuf[i,1]=Typ;
	PrStBuf[i,2]=Obj[4];
	PrStBuf[i,3]=Beg[4];
	PrStBuf[i,8+1]=Cut[1];
	PrStBuf[i,8+2]=Cut[2];
	PrStBuf[i,8+3]=Cut[3];
	PrStBuf[i,8+4]=Cut[4];
	PrStBuf[i,8+5]=Cut[5];
	PrStBuf[i,8+6]=Cut[6];
	////////////////////////////////////
	} else {
		if (i<200)	{
			goto CashSave;
			}
	}
////////////////////////////////////////////////////////////////////////////////
exit
